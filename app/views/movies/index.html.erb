<%= link_to "マイページ" , user_path(current_user) %>
  <%= form_tag(root_path, method: :get) do %>
    <%= search_field_tag :looking_for,nil, placeholder: 'Movie Title...',value: params[:looking_for] %>
    <% search_field_tag :page, nil, value: params[:page] %>
    <%= submit_tag '検索' %>
  <% end %>

<!--ジャンル検索用-->
  <% form_tag(root_path, method: :get) do %>
    <% search_field_tag :genre,nil,value: params[:genre] %>
    <% search_field_tag :page_for, nil,value: params[:page_for] %>
    <% submit_tag '検索' %>
  <% end %>
 

      <div class="genre_wrapper">
          <%= link_to "#Action", "/?utf8=%E2%9C%93&genre=28&commit=%E6%A4%9C%E7%B4%A2"      ,class: "editlink" %>
          <%= link_to "#Adventure", "/?utf8=%E2%9C%93&genre=12&commit=%E6%A4%9C%E7%B4%A2"  ,class: "editlink" %>
          <%= link_to "#Anime", "/?utf8=%E2%9C%93&genre=16&commit=%E6%A4%9C%E7%B4%A2"          ,class: "editlink" %>
          <%= link_to "#Family", "/?utf8=%E2%9C%93&genre=10751&commit=%E6%A4%9C%E7%B4%A2"   ,class: "editlink" %>
          <%= link_to "#Horror", "/?utf8=%E2%9C%93&genre=27&commit=%E6%A4%9C%E7%B4%A2"          ,class: "editlink" %>
          <%= link_to "#Romance", "/?utf8=%E2%9C%93&genre=10749&commit=%E6%A4%9C%E7%B4%A2"     ,class: "editlink" %>
          <%= link_to "#Thriller", "/?utf8=%E2%9C%93&genre=53&commit=%E6%A4%9C%E7%B4%A2"      ,class: "editlink" %>
          <%= link_to "#War", "/?utf8=%E2%9C%93&genre=10752&commit=%E6%A4%9C%E7%B4%A2"         ,class: "editlink" %>
        </div>
        
 
        
  

<!--ジャンル検索結果-->
<%if params[:genre].present? %>

 <% movieinfo = JSON.parse(Tmdb::Genre.movies(params[:genre], page: 1).to_json) %>
 <h2 class="top">Movies</h2>
  <div class="container">
    <div class="row">
        <% i = 0 %>
        <% while i < movieinfo['table']['results'].count %>
          <div class="col-3">
            
            <% if movieinfo['table']['results'][i]['table']['poster_path'].present? %>
              <%= link_to image_tag('https://image.tmdb.org/t/p/w1280' + movieinfo['table']['results'][i]['table']['poster_path'],class: "image"),detail_path(movieinfo['table']['results'][i]['table']['id']) %>
            <%end%>
            <div class="movie-title">
            <%if movieinfo['table']['results'][i]['table']['title'].present?%>
              <%= movieinfo['table']['results'][i]['table']['title'] %>
            <%end%>
            </div>
            <div class="release_date">
            <%if movieinfo['table']['results'][i]['table']['release_date'].present?%>
              <%= movieinfo['table']['results'][i]['table']['release_date'] %>
            <%end%>
            </div>
           </div>
        <% i += 1%>
        <%end%>
    </div>
  </div>
  
<% elsif params[:looking_for].present? %>
<!--検索結果-->
  
  <% movie = JSON.parse(Tmdb::Search.movie(params[:looking_for]).to_json) %>
  <% movie["table"]["total_pages"] %>
  <!--結果全てを表示するように繰り返し-->
  <h2 class="top">Movies</h2>
  <% n = 1 %>
  <% while n <  movie["table"]["total_pages"] + 1 %>
  <% movieinfo = JSON.parse(Tmdb::Search.movie(params[:looking_for],page: n).to_json) %>
  
    <div class="container">
      <div class="row">
        <% i = 0 %>
        <% while i < movieinfo['table']['results'].count %>
         
          <div class="col-3">
           
            <% if movieinfo['table']['results'][i]['table']['poster_path'].present? %>
              <%= link_to image_tag('https://image.tmdb.org/t/p/w1280' + movieinfo['table']['results'][i]['table']['poster_path'],class: "image"),detail_path(movieinfo['table']['results'][i]['table']['id']) %>
            <%end%>
             <div class="movie-title">
            <%if movieinfo['table']['results'][i]['table']['title'].present?%>
              <%= movieinfo['table']['results'][i]['table']['title'] %>
            <%end%>
            </div>
            <div class="release_date">
            <%if movieinfo['table']['results'][i]['table']['release_date'].present?%>
              <%= movieinfo['table']['results'][i]['table']['release_date'] %>
            <%end%>
            </div>
          </div> 
        <% i += 1%>
        <%end%>
      </div>
    </div>
     <% n += 1 %>
    <% end %>
<% else %>
  <!--評価が5のレビューをランダムにひとつ取得して表示させる-->
  
  <% @popular_movie = JSON.parse((Tmdb::Movie.popular).to_json) %>
  <h2 class="top">Movies</h2>
    <div class="container">
      <div class="row">
        
        <% i = 0 %>
        <% while i < @popular_movie['table']['results'].count %>
          <div class="col-3">
            
            <% if @popular_movie['table']['results'][i]['table']['poster_path'].present? %>
              <%= link_to image_tag('https://image.tmdb.org/t/p/w1280' + @popular_movie['table']['results'][i]['table']['poster_path'], class: "image"), detail_path(@popular_movie['table']['results'][i]['table']['id']) %>
            <%end%>
            <div class="movie-title">
            <%if @popular_movie['table']['results'][i]['table']['title'].present?%>
              <%= @popular_movie['table']['results'][i]['table']['title'] %>
            <% end %>  
            </div>
            <div class="release_date">
            <%if @popular_movie['table']['results'][i]['table']['release_date'].present?%>
              <%= @popular_movie['table']['results'][i]['table']['release_date'] %>
            <%end%>
            </div>
          </div>
        <% i += 1%>
        <%end%>
      </div>
    </div>
    <% end %>


    
  Copyright（c）2015 18Months Srl